{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Phonon Linewidth and Frequency Shift\n",
    "\n",
    "Phonon linewidth and frequency shift can be computed with perturbation theory using the phonon interactions calculated with the methods in this package.\n",
    "The formulas are well defined for both quantities.\n",
    "\n",
    "The algorithms for both quantities are optimized and parallelized for efficiency.\n",
    "\n",
    "For convenience and minimization of integration error, tetrahedron method is used for integration over the Brillouin zone."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Phonon interaction strength\n",
    "\n",
    "Phonon interaction strength is the renormalized dynamic tensors used in computation of phonon linewidth and shift.\n",
    "\n",
    "\n",
    "$$\n",
    "\\Phi_{q_1}^{j_1}{}_{\\cdots}^{\\cdots}{}_{q_\\mathcal{N}}^{j_\\mathcal{N}} = \\frac{1}{\\sqrt{N}}\\frac{1}{\\mathcal{N} !}\n",
    "\\sum_{\\alpha_1 \\cdots \\alpha_\\mathcal{N}} \\sum_{a_1 \\cdots a_\\mathcal{N}} %\n",
    "\\left[\n",
    "D_{q_1}^{a_1 \\alpha_1}{}_{\\cdots}^{\\cdots}{}_{q_\\mathcal{N}}^{a_\\mathcal{N} \\alpha_\\mathcal{N}} \\nonumber\n",
    "\\prod_{i=1,...,\\mathcal{N}} \n",
    "\\left( W_{q_i, j_i}^{a_i, \\alpha_i} \n",
    "\\sqrt{\\frac{\\hbar}{2 m_{a_i} \\omega_{q_i j_i}}} \\right)\n",
    "\\right]\n",
    "$$\n",
    "\n",
    "where \n",
    "$\\sum_{i=1,\\cdots,\\mathcal{N}} q_i = \\vec{G}$\n",
    "$D$ is the dynamic tensor,\n",
    "N is the size of FTG,\n",
    "$\\mathcal{N}$ is the order of the derivative,\n",
    "$W$ is the eigen vectors,\n",
    "$m$ is the mass of the atoms,\n",
    "and\n",
    "$\\omega$ is the phonon frequencies."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Linewidth\n",
    "\n",
    "The formula to compute phonon linewidth (a.k.a imaginary part of phonon self energy) is as follows.\n",
    "\n",
    "$$\n",
    "\\Gamma_{q, j}(\\omega) = \\frac{18 \\pi}{\\hbar^2}\\sum_{j^{\\prime} j^{\\prime\\prime} q^{\\prime}} \n",
    "|\\Phi_{\\bar{q}}^{j} {}_{q^{\\prime}}^{j^{\\prime}} {}_{q - q^{\\prime}}^{j^{\\prime\\prime}}|^2 \n",
    "\\{ \n",
    "  \\left(n_{q^{\\prime}, j^{\\prime}} + n_{q - q^{\\prime}, j^{\\prime\\prime}} + 1\\right) \n",
    "  \\delta \\left(\\omega - \\omega_{q^{\\prime}, j^{\\prime}} - \\omega_{q - q^{\\prime}, j^{\\prime\\prime}}\\right) \n",
    "  \\nonumber \\\\ \n",
    "   +\n",
    "  \\left(n_{q^{\\prime}, j^{\\prime}} - n_{q - q^{\\prime}, j^{\\prime\\prime}}\\right)\n",
    "  \\left[ \\delta \\left(\\omega + \\omega_{q^{\\prime}, j^{\\prime}} - \\omega_{q - q^{\\prime}, j^{\\prime\\prime}}\\right)\n",
    "          -\n",
    "         \\delta \\left(\\omega - \\omega_{q^{\\prime}, j^{\\prime}} + \\omega_{q - q^{\\prime}, j^{\\prime\\prime}}\\right)\n",
    "  \\right]\n",
    "\\}\n",
    "$$\n",
    "\n",
    "where $\\Phi$ is the phonon interaction strength.\n",
    "\n",
    "The delta functions here can be integrated using tetrahedron method described in Blöchl's paper \n",
    "([P. E. Blöchl, O. Jepsen, and O. K. Andersen, Phys. Rev. B 49, 16223 (1994)](https://doi.org/10.1103/PhysRevB.49.16223))."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Frequency shift\n",
    "\n",
    "Phonon frequency shift is also the real part of phonon self energy, which is the real part of the following formula.\n",
    "\n",
    "$$\n",
    "\\Delta_{\\kappa} = \\frac{12}{\\hbar} \\sum_{q^{\\prime}} \\Phi_{\\kappa, -\\kappa, \\kappa^{\\prime}, -\\kappa^{\\prime}}\n",
    "(2 \\bar{n}_{\\kappa^{\\prime}} - 1) \\\\\n",
    "-\\frac{18}{\\hbar^2} \\sum_{\\kappa^{\\prime} \\kappa^{\\prime\\prime}} \\left\\{ \n",
    "\\left| \\Phi_{\\kappa, \\kappa^{\\prime}, \\kappa^{\\prime\\prime}}\\right|^2\n",
    "    \\left[ \n",
    "        \\frac{\\bar{n}_{\\kappa^{\\prime}} + \\bar{n}_{\\kappa^{\\prime\\prime}} + 1}\n",
    "            {\\left(\\omega_{\\kappa} + \\omega_{\\kappa^{\\prime}} + \\omega_{\\kappa^{\\prime\\prime}}\\right)_p}\n",
    "       +\\frac{- \\bar{n}_{\\kappa^{\\prime}} + \\bar{n}_{\\kappa^{\\prime\\prime}}}\n",
    "            {\\left(\\omega_{\\kappa} + \\omega_{\\kappa^{\\prime}} - \\omega_{\\kappa^{\\prime\\prime}}\\right)_p}\n",
    "       +\\frac{\\bar{n}_{\\kappa^{\\prime}} - \\bar{n}_{\\kappa^{\\prime\\prime}}}\n",
    "            {\\left(\\omega_{\\kappa} - \\omega_{\\kappa^{\\prime}} - \\omega_{\\kappa^{\\prime\\prime}}\\right)_p}\n",
    "       +\\frac{\\bar{n}_{\\kappa^{\\prime}} + \\bar{n}_{\\kappa^{\\prime\\prime}} + 1}\n",
    "            {\\left(\\omega_{\\kappa} - \\omega_{\\kappa^{\\prime}} - \\omega_{\\kappa^{\\prime\\prime}}\\right)_p}\n",
    "    \\right] \\\\\n",
    "    + 2 \\Phi_{\\kappa, -\\kappa, \\kappa^{\\prime\\prime}}\n",
    "        \\Phi_{\\kappa^{\\prime}, -\\kappa^{\\prime}, \\kappa^{\\prime\\prime}}\n",
    "        \\frac{2\\bar{n}_{\\kappa^{\\prime}} + 1}{\\left(\\omega_{\\kappa^{\\prime\\prime}}\\right)_p}\n",
    "\\right\\}\n",
    "$$\n",
    "\n",
    "where $\\kappa=(q, j)$, \n",
    "$\\Phi$ is the phonon interaction strength,\n",
    "and due to conservation of momentum, \n",
    "in $\\Phi_{\\kappa, \\kappa^{\\prime}, \\kappa^{\\prime\\prime}}$, $q^{\\prime\\prime} = - q - q^{\\prime}$\n",
    "and in $\\Phi_{\\kappa, -\\kappa, \\kappa^{\\prime\\prime}}$ and \n",
    "    $\\Phi_{\\kappa^{\\prime}, -\\kappa^{\\prime}, \\kappa^{\\prime\\prime}}$,\n",
    "    $q^{\\prime\\prime} = \\Gamma$.\n",
    "    \n",
    "The first part of the equation is the loop (L) diagram, the second bubble (B) diagram and the third tadpole (T) diagram. \n",
    "(Ref: [M. Lazzeri, M. Calandra, and F. Mauri, Phys. Rev. B 68, 220509(R) (2003)](https://doi.org/10.1103/PhysRevB.68.220509))\n",
    "    \n",
    "These Brillouin integrations can be executed with tetrahedron method described Kaprzyk's paper \n",
    "([S.Kaprzyk, Comp. Phys. Comm. 183, 2, 347 (2012)](https://doi.org/10.1016/j.cpc.2011.08.022)).\n",
    "Since this is formula for phonon self energy the imaginary part the integration should match the result of phonon linewidth taking signs into consideration, and the real part is the phonon frequency shift."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Thermal conductivity\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Relaxation time approximation\n",
    "\n",
    "First, phonon life time can be computed from the linewidth\n",
    "$$\n",
    "\\tau_{\\textbf{q},j}=\\frac{1}{\\Gamma_{q, j}(\\omega_{q, j})}\n",
    "$$\n",
    "\n",
    "Then, the mode dependent heat capacity can be computed from phonon frequencies\n",
    "$$\n",
    "C_{\\textbf{q},j} = \n",
    "k_{B} \n",
    "\\left(\\frac{\\hbar\\omega_{\\textbf{q},j}}{k_{B}T}\\right)^2\n",
    "\\frac{\\exp({\\hbar\\omega_{\\textbf{q},j}}/{k_{B}T})}{[\\exp({\\hbar\\omega_{\\textbf{q},j}}/{k_{B}T}) - 1]^2}\n",
    "$$\n",
    "\n",
    "The RTA thermal conductivity can be computed with phonon life time, mode heat capacity, and mode group velocity\n",
    "$$\n",
    "\\kappa^{RTA} = \\frac{1}{N\\Omega}\\sum_{\\textbf{q},j} \n",
    "C_{\\textbf{q},j} \n",
    "\\textbf{v}_{\\textbf{q},j} \\otimes \\textbf{v}_{\\textbf{q},j}\n",
    "\\tau_{\\textbf{q},j}\n",
    "$$\n",
    "\n",
    "\n",
    "Ref:\n",
    "[A. Togo, L. Chaput, and I. Tanaka, Phys. Rev. B 91, 094306 (2015)](https://doi.org/10.1103/PhysRevB.91.094306)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Linear Boltzmann Transport Equatione (LBTE)\n",
    "\n",
    "Here we implemented the direct solution to the LBTE instead of the interative one, \n",
    "described in the referenced papers.\n",
    "\n",
    "Ref:\n",
    "[Chaput, Phys. Rev. Lett. 110, 265506 (2013)](https://doi.org/10.1103/PhysRevLett.110.265506),\n",
    "[Fugallo, et al. Phys. Rev. B 88, 045430 (2013)](https://doi.org/10.1103/PhysRevB.88.045430)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}

.. _crystal-structure:

Entering Crystal Structures 
===============================

For many different tasks performed in the PM suite, a crystal structure, or
some component of a crystal structure, must be provided to the code. Most
likely, this will be done using a yaml input file, and the two required key words
are **vec** and **atoms**, which will contain the lattice vectors and the basis atoms, respectively.
Considering the flourite structure, the most straightforward yaml file would be::

  vec: 
    [[0.000000,2.764309,2.764309],
     [2.764309,0.000000,2.764309],
     [2.764309,2.764309,0.000000]]
  atoms:
    - Ca: 
       [[0,0,0]]
    - F:
       [[0.25,0.25,0.25],
        [0.75,0.75,0.75]]
The code will infer that there is one basis atom labeled *Ca* and two basis atoms labeled *F*.

When entering matrices, we will always run the input through our general array
parser (see parse_array if interested in the details). Therefore, there are many different
options for entering a matrix as a string. For example, consider::


  scale: 2.764309
  vec: |
     0 1 1
     1 0 1
     1 1 0
  atoms:
    - Ca: |
       0 0 0
    - F: |
       1/4 1/4 1/4
       3/4 3/4 3/4

where **scale** is a constant that multiplies all lattice vectors (a list of
three constants could have been provided), and the vertical lines tells yaml to
expect a text block.  Our parser has a hierarchy of delimiters, ranging from
space, comma, semicolon, newline. In the above example, we have two types of
delimiters (i.e. spaces and newlines), which tells the code to form a matrix. 
One of the more compact ways to achieve the same input files as above is::

  scale: 2.764309
  vec: |
     0 1 1 ; 1 0 1 ; 1 1 0
  atoms:
    - Ca: |
       0 0 0
    - F: |
       1/4 1/4 1/4 ; 3/4 3/4 3/4

.. Note::
  
  Currently, errors within the yaml file yield exceptions that are not intuitive. For example, the file
  below needs at least more space before the coordinates are entered for Ca and F, and the lack thereof
  leads to the following exception ::

    scale: 2.764309
    vec: |
       0 1 1 ; 1 0 1 ; 1 1 0
    atoms:
      - Ca: |
        0 0 0
      - F: |
        1/4 1/4 1/4 ; 3/4 3/4 3/4

  Traceback (most recent call last):
    File "/home/cam1/git_projects/principia_materia/venv/bin/pm-periodica", line 33, in <module>
      sys.exit(load_entry_point('principia-materia', 'console_scripts', 'pm-periodica')())
    File "/home/cam1/git_projects/principia_materia/principia_materia/cli/periodica_cli.py", line 130, in main
      structure = get_structure(data["structure"].read(), stype=CrystalFTG)
    File "/home/cam1/git_projects/principia_materia/principia_materia/translation_group/__init__.py", line 175, in get_structure
      raise ValueError("Error occured processing input variable inp.")
  ValueError: Error occured processing input variable inp.

